\documentclass{article}
\usepackage{blindtext}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{makecell}
\usepackage{amsmath,amssymb,amsfonts,amsopn,dsfont}

\title{Deflation results with MCMC}
%\author{Gubert Farnsworth}
%\date{\today}

\begin{document}

\maketitle

\section{A handful of constant preconditioners}
Constant preconditioners are considered for the realization $\xi=\mathbf{1}$, denoted by $\mathbf{A}_0$.
\subsection{Block Jacobi (bJ)}
We first consider non-overlapping diagonal bJ preconditioners of the form
\begin{align}
\mathbf{M}^{-1}=\sum_{j=1}^{n_b}\boldsymbol{\mathcal{R}}_j\mathbf{M}_j^{-1}\boldsymbol{\mathcal{R}}_j^T
\end{align}
with canonical restrictions $\boldsymbol{\mathcal{R}}_j$ from a global vector to each block $j\in[1,n_b]$.
For each $j$, $\mathbf{M}_j^{-1}$ is applied with a Cholesky factorization $\mathbf{M}_j=\mathbf{L}_j\mathbf{L}_j^T=\boldsymbol{\mathcal{R}}_j^T\mathbf{A}\boldsymbol{\mathcal{R}}_j$.

\subsection{Geometric domain decomposition}
Let us consider a $n_d$-partition of $\Omega$ into subdomains $\{\Omega_d\}_{d=1}^{n_d}$ where each $\Omega_d$ is a contiguous union of elements, with a (non-Dirichlet) boundary denoted by $\partial\Omega_d$.
The canonical restriction $\boldsymbol{\mathcal{R}}_d$ maps global (non-Dirichlet) degrees of freedom (DoFs) to mesh nodes contained in $\Omega_d$.
We assume local orderings such that $\boldsymbol{\mathcal{R}}_d=[\boldsymbol{\mathcal{R}}_{\mathrm{I},d},\boldsymbol{\mathcal{R}}_{\Gamma,d}]$,
where $\boldsymbol{\mathcal{R}}_{\mathrm{I},d}$ and $\boldsymbol{\mathcal{R}}_{\Gamma,d}$ map nodes from $\Omega_d\setminus\partial\Omega_d$ and $\partial\Omega_d$, respectively.
Then, we write
\begin{align}
\boldsymbol{\mathcal{R}}_d^T\mathbf{A}\boldsymbol{\mathcal{R}}_d=
\begin{bmatrix}\boldsymbol{\mathcal{R}}_{\mathrm{I},d}^T\\\boldsymbol{\mathcal{R}}_{\Gamma,d}^T\end{bmatrix}
\mathbf{A}
\begin{bmatrix}\boldsymbol{\mathcal{R}}_{\mathrm{I},d}&\boldsymbol{\mathcal{R}}_{\Gamma,d}\end{bmatrix}=:
\begin{bmatrix}
\mathbf{A}_{\mathrm{II},d}&\mathbf{A}_{\mathrm{I}\Gamma,d}\\
\mathbf{A}_{\Gamma \mathrm{I},d}&\mathbf{A}_{\Gamma\Gamma,d}
\end{bmatrix}
\end{align}
and
\begin{align}
\boldsymbol{\mathcal{R}}_d^T\mathbf{b}=
\begin{bmatrix}\boldsymbol{\mathcal{R}}_{\mathrm{I},d}^T\\\boldsymbol{\mathcal{R}}_{\Gamma,d}^T\end{bmatrix}\mathbf{b}=:
\begin{bmatrix}\mathbf{b}_{\mathrm{I},d}\\\mathbf{b}_{\Gamma,d}\end{bmatrix}.
\end{align}
The original system can be re-ordered as follows,
\begin{align}
\begin{bmatrix}
\mathbf{A}_{\mathrm{II},1}&&&\mathbf{A}_{\mathrm{I\Gamma},1}\\
&\ddots&& \vdots\\
&&\mathbf{A}_{\mathrm{II},n_d}&\mathbf{A}_{\mathrm{I\Gamma},n_d}\\
\mathbf{A}_{\mathrm{I\Gamma},1}&\cdots&\mathbf{A}_{\mathrm{I\Gamma},n_d}& \mathbf{A}_{\Gamma\Gamma} 
\end{bmatrix}
\begin{bmatrix}
\mathbf{b}_{\mathrm{I},1}\\
\vdots\\
\mathbf{b}_{\mathrm{I},n_d}\\
\mathbf{b}_{\Gamma}
\end{bmatrix}
=
\begin{bmatrix}
\mathbf{u}_{\mathrm{I},1}\\
\vdots\\
\mathbf{u}_{\mathrm{I},n_d}\\
\mathbf{u}_{\Gamma}
\end{bmatrix}
\end{align}
where $\mathbf{A}_{\mathrm{II}}\mathbf{u}_{\mathrm{I},d}=\mathbf{b}_{\mathrm{I},d}-\mathbf{A}_{\mathrm{I}\Gamma,d}\mathbf{u}_{\Gamma}$.
After elimination of $\mathbf{u}_{\mathrm{I}}$ from Eq.~\eqref{}, a condensed problem
\begin{align}
\mathbf{S}\mathbf{u}_{\Gamma}=\mathbf{b}_S
\end{align}
is obtained for $\mathbf{u}_\Gamma$ 
where $\mathbf{b}_S=\mathbf{b}_\Gamma-\mathbf{A}_{}$.
The global Schur complement $\mathbf{S}$ combines contributions from each local Schur complement
\begin{align}
\mathbf{S}_d=
\mathbf{A}_{\Gamma\Gamma,d}-
\mathbf{A}_{\Gamma\mathrm{I},d}\mathbf{A}_{\mathrm{II},d}^{-1}\mathbf{A}_{\mathrm{I}\Gamma,d}
\;,\;\;
d=1,\dots,n_d,
\end{align}
all of which are combined to form $\mathbf{S}=\sum_{d=1}^{n_d}\boldsymbol{\mathcal{R}}_d\mathbf{S}_d\boldsymbol{\mathcal{R}}_d^T$.
Note that, for non-overlapping partitions, $\mathbf{A}_{\mathrm{II},d}$ is SPD, but $\mathbf{S}_{d}$ is symmetric positive semi-definite.

\subsubsection{Neumann-Neumann (NN)}
The NN preconditioner $\mathbf{M}_{NN}^{-1}$, see~\cite{}, is defined as follows for Eq.~\eqref{},
\begin{align}
\mathbf{M}_{NN}^{-1}=\sum_{d=1}^{n_d}
\boldsymbol{\mathcal{R}}_{\Gamma,d}
\mathbf{D}
\mathbf{S}_d^\dagger
\mathbf{D}
\boldsymbol{\mathcal{R}}_{\Gamma,d}^T,
\end{align}
where $\mathbf{S}_d^\dagger$ denotes the pseudo-inverse of $\mathbf{S}_d$,
and $\mathbf{D}_d$ is a weight matrix which, altogether with the weight matrices of the other subdomains, 
forms a decomposition of unity for the nodes on the interface $\partial\Omega=\cup_{d=1}^{n_d}\partial\Omega_d$, i.e.,
\begin{align}
\sum_{d=1}^{n_d}
\boldsymbol{\mathcal{R}}_{\Gamma,d}
\mathbf{D}_d
\boldsymbol{\mathcal{R}}_{\Gamma,d}^T
=\mathbf{I}.
\end{align}
It is customary to let $\mathbf{D}_d$ be diagonal with ***.

\subsubsection{Balanced domain decomposition (BDD)}
NN does not scale.

\subsubsection{Low rank Schur (LORASC)}

\begin{align}
\mathbf{S}\mathbf{u}=\lambda\mathbf{A}_{\Gamma\Gamma}\mathbf{u}
\end{align}

\begin{align}
\tilde{\mathbf{S}}^{-1}=\mathbf{A}_{\Gamma\Gamma}^{-1}+\mathbf{E}\boldsymbol{\Sigma}\mathbf{E}^T
\end{align}
where $\mathbf{E}=[\mathbf{v}_1,\dots,\mathbf{v}_i]$

\subsection{Algebraic multigrid (AMG)}

\section{Deflation results}

\subsection{Weak scaling}
Results in Tab.~\ref{Tab:005} are *.


% 320,000_bj64@hector stuck at 1st attempt of chain 11/50, 
%                           just after realization 3/5 (2,216 iter).
% 320,000_bj128@lucien stuck at 4th attempt of chain 30/50,
%                            just after realization 1/5 (3900 iter).
% 320,000_lorasc128@lucien stuck at 1st attempt of chain 2/50, 
%                                just after realization 4/5 (229 iter).



\begin{table}[ht]
	\caption{Weak scaling results of deflation for a constant bJ preconditioner with $nvec=\lfloor1.25\times nb\rfloor$ and $spdim=3\times nb$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		n & nb & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
		\hline
		20,208  &   8 &   828.6 $\pm$ 166.5 &  10 &  24 &   488.6 $\pm$  93.4 & xxx.xx $\pm$ xx.xx \\
		40,406  &  16 & 1,435.2 $\pm$ 357.2 &  20 &  48 &   715.3 $\pm$ 154.6 & xxx.xx $\pm$ xx.xx \\
		80,598  &  32 & 2,241.5 $\pm$ 528.4 &  40 &  96 & 1,043.2 $\pm$ 294.2 & xxx.xx $\pm$ xx.xx \\
		160,941 &  64 & 3,321.4 $\pm$ 559.3 &  80 & 192 & 1,340.8 $\pm$ 370.6 & xxx.xx $\pm$ xx.xx \\
		321,386 & 128 & 5,698.0 $\pm$ 862.7 & 160 & 384 & 2,996.1 $\pm$ 728.3 & xxx.xx $\pm$ xx.xx \\
		\hline
	\end{tabular}
	\label{Tab:005}
\end{table}


\begin{table}[ht]
\caption{Weak scaling results of deflation for a constant LORASC preconditioner with $\varepsilon=0$, $nvec=\lfloor1.25\times ndom\rfloor$ and $spdim=3\times ndom$.}
\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
	\hline
	n & ndom & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
	\hline
	20,208  &   8 & 243.9 $\pm$  49.9 &  10 &  24 & 158.6 $\pm$ 35.7 & xxx.x $\pm$ xx.x \\
	40,406  &  16 & 348.3 $\pm$  89.6 &  20 &  48 & 181.7 $\pm$ 43.0 & xxx.x $\pm$ xx.x \\
	80,598  &  32 & 453.9 $\pm$ 115.9 &  40 &  96 & 201.6 $\pm$ 51.1 & xxx.x $\pm$ xx.x \\
	160,941 &  64 & 603.2 $\pm$ 134.7 &  80 & 192 & 239.5 $\pm$ 47.0 & xxx.x $\pm$ xx.x \\
	321,386 & 128 & 781.0 $\pm$ 000.0 & 160 & 384 & 280.0 $\pm$ 00.0 & xxx.x $\pm$ xx.x \\
	\hline
\end{tabular}
\label{Tab:010}
\end{table}

\begin{table}[ht]
	\caption{Weak scaling results of deflation for a constant LORASC preconditioner with $\varepsilon=0.01$, $nvec=\lfloor1.25\times ndom\rfloor$ and $spdim=3\times ndom$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
	\hline
	n & ndom & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
	\hline
	20,208  &   8 & 231.6 $\pm$  47.8 &  10 &  24 & 160.0 $\pm$ 36.3 & xxx.x $\pm$ xx.x \\
	40,406  &  16 & 324.5 $\pm$  84.0 &  20 &  48 & 182.3 $\pm$ 44.2 & xxx.x $\pm$ xx.x \\
	80,598  &  32 & 388.7 $\pm$  98.3 &  40 &  96 & 202.5 $\pm$ 53.7 & xxx.x $\pm$ xx.x \\
	160,941 &  64 & 498.3 $\pm$ 116.6 &  80 & 192 & 236.6 $\pm$ 45.4 & xxx.x $\pm$ xx.x \\
	321,386 & 128 & 661.0 $\pm$ 000.0 & 160 & 384 & 283.0 $\pm$ 00.0 & xxx.x $\pm$ xx.x \\
	\hline
\end{tabular}
	\label{Tab:015}
\end{table}



\begin{table}[ht]
	\caption{Weak scaling results of deflation for a constant Neumann-Neumann preconditioner with $nvec=\lfloor1.25\times ndom\rfloor$ and $spdim=3\times ndom$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|c|}
	\hline
	$n$ & $n_\Gamma$ & ndom & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
	\hline
	20,208  & 641    &   8 &  77.6 $\pm$  19.9 &  10 &  24  & 71.3 $\pm$ 17.8 & xxx.x $\pm$ xx.x \\
	40,406  & 1,422  &  16 & 107.3 $\pm$  28.3 &  20 &  48  & 89.7 $\pm$ 27.3 & xxx.x $\pm$ xx.x \\
	80,598  & 2,800  &  32 & 157.2 $\pm$  29.8 &  40 &  96 &  94.9 $\pm$ 27.2 & xxx.x $\pm$ xx.x \\
	160,941 & 5,600  &  64 & 533.9 $\pm$  88.0 &  80 & 192 & 273.1 $\pm$ 84.8 & xxx.x $\pm$ xx.x \\
	321,386 & 11,200 & 128 & 794.0 $\pm$ 129.3 & 160 & 384 & 313.5 $\pm$ 83.0 & xxx.x $\pm$ xx.x \\
	\hline
    \end{tabular}
	\label{Tab:025}
\end{table}

\subsection{Strong scaling results}


\begin{table}[ht]
	\caption{Strong scaling results of deflation for a constant bJ preconditioner with $nvec=\lfloor1.25\times nb\rfloor$ and $spdim=3\times nb$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		n & nb & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
		\hline
		321,386 &   8 & x,xxx.x $\pm$ xx.xx &  10 &  24 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
        321,386 &  16 & x,xxx.x $\pm$ xx.xx &  20 &  48 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
        321,386 &  32 & x,xxx.x $\pm$ xx.xx &  40 &  96 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
        321,386 &  64 & 4,256.9 $\pm$ 452.4 &  80 & 192 & 1,959.0 $\pm$ 550.7 & xxx.xx $\pm$ xx.xx \\
		321,386 & 128 & 5,698.0 $\pm$ 862.7 & 160 & 384 & 2,996.1 $\pm$ 728.3 & xxx.xx $\pm$ xx.xx \\
		\hline
	\end{tabular}
	\label{Tab:030}
\end{table}


\begin{table}[ht]
	\caption{Strong scaling results of deflation for a constant LORASC preconditioner with $\varepsilon=0$, $nvec=\lfloor1.25\times nb\rfloor$ and $spdim=3\times nb$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		n & nb & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
		\hline
		321,386 &   8 & xxx.xx $\pm$ xx.xx &  10 &  24 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
		321,386 &  16 & xxx.xx $\pm$ xx.xx &  20 &  48 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
		321,386 &  32 & xxx.xx $\pm$ xx.xx &  40 &  96 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
		321,386 &  64 & xxx.xx $\pm$ xx.xx &  80 & 192 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
		321,386 & 128 & xxx.xx $\pm$ xx.xx & 160 & 384 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
		\hline
	\end{tabular}
	\label{Tab:035}
\end{table}


\begin{table}[ht]
	\caption{Strong scaling results of deflation for a constant Neumann-Neumann preconditioner with $nvec=\lfloor1.25\times ndom\rfloor$ and $spdim=3\times ndom$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		$n_\Gamma$ & ndom & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
		\hline
		xx  &   8 & xxx.x $\pm$  xx.x &  10 &  24 & xxx.x $\pm$ xx.x & xxx.x $\pm$ xx.x \\
		xx  &  16 & xxx.x $\pm$  xx.x &  20 &  48 & xxx.x $\pm$ xx.x & xxx.x $\pm$ xx.x \\
		xx  &  32 & xxx.x $\pm$  xx.x &  40 &  96 & xxx.x $\pm$ xx.x & xxx.x $\pm$ xx.x \\
		xx  &  64 & xxx.x $\pm$  xx.x &  80 & 192 & xxx.x $\pm$ xx.x & xxx.x $\pm$ xx.x \\
		xx  & 128 & xxx.x $\pm$  xx.x & 160 & 384 & xxx.x $\pm$ xx.x & xxx.x $\pm$ xx.x \\
		\hline
	\end{tabular}
	\label{Tab:040}
\end{table}

\subsection{Scaling of AMG}

\begin{table}[ht]
	\caption{Scaling results of the constant AMG preconditioner.}
	\centering
	\begin{tabular}{|c|c|}
		\hline
		n & pcg iter \\
		\hline
		20,208  & 125.9 $\pm$ 35.0 \\
		40,406  & 136.5 $\pm$ 39.2  \\
		80,598  & 144.7 $\pm$ 51.7  \\
		160,941 & 150.4 $\pm$ 48.3  \\
		321,386 & xxx.x $\pm$ xx.x  \\
		\hline
	\end{tabular}
	\label{Tab:020}
\end{table}



\end{document}