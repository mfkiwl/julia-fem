\documentclass{article}
\usepackage{blindtext}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{makecell}

% Maths
\usepackage{amsmath,amssymb,amsfonts,amsopn,dsfont}

% My math operators
\input{/home/nicolas/Dropbox/Git/tex-thesis-ubx-cerfacs/template_ub/my-operators.tex}

% Algos
\usepackage{algorithm}
\usepackage{algorithmic}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\usepackage{tikz}
\renewcommand{\algorithmiccomment}[1]{{\hfill\color{gray}$\triangleright$ #1}}


\title{Deflation results with MCMC}
\author{N. Venkovic \and P. Mycek \and L. Giraud \and O.P. Le Ma\^{i}tre}
\date{\today}

\begin{document}

\maketitle

We want to solve
\begin{align}\label{eq:000}
\mathbf{A}\mathbf{u}=\mathbf{b}
\end{align}
where $\mathbf{A}$ is SPD.

\section{A handful of constant preconditioners}
Constant preconditioners are considered for the realization $\xi=\mathbf{1}$, denoted by $\mathbf{A}_0$.
\subsection{Block Jacobi (bJ)}
We first consider non-overlapping diagonal bJ preconditioners of the form
\begin{align}\label{eq:005}
\mathbf{M}^{-1}=\sum_{j=1}^{n_b}\Rloc{j}\mathbf{M}_j^{-1}\Rloc{j}^T
\end{align}
with canonical restrictions $\Rloc{j}$ from a global vector to each block $j\in[1,n_b]$.
For each $j$, $\mathbf{M}_j^{-1}$ is applied with a Cholesky factorization $\mathbf{M}_j=\mathbf{L}_j\mathbf{L}_j^T=\Rloc{j}^T\mathbf{A}\Rloc{j}$.

\subsection{Non-overlapping geometric domain decomposition}
Let us consider a $n_d$-partition of $\Omega$ into subdomains $\{\Omega_d\}_{d=1}^{n_d}$ where each $\Omega_d$ is a contiguous union of elements of the mesh, with a (non-Dirichlet) boundary denoted by $\partial\Omega_d$.
The canonical restriction $\Rloc{d}$ maps global (non-Dirichlet) degrees of freedom (DoFs) to mesh nodes contained in $\Omega_d$.
We assume local orderings such that $\Rloc{d}=[\RIloc{d},\RGloc{d}]$,
where $\RIloc{d}$ and $\RGloc{d}$ map nodes from $\Omega_d\setminus\partial\Omega_d$ and $\partial\Omega_d$, respectively.
Then, we write
\begin{align}\label{eq:010}
\Rloc{d}^T\mathbf{A}\Rloc{d}=
\begin{bmatrix}
\RIloc{d}^T\\
\RGloc{d}^T
\end{bmatrix}
\mathbf{A}
\begin{bmatrix}
\RIloc{d}&\RGloc{d}
\end{bmatrix}=:
\begin{bmatrix}
\AIIloc{d}&\AIGloc{d}\\
\AGIloc{d}&\AGGloc{d}
\end{bmatrix}
\end{align}
and
\begin{align}\label{eq:015}
{\boldsymbol{\mathcal{R}}^{\!(d)}}^T\mathbf{b}=
\begin{bmatrix}
\RIloc{d}\\
\RGloc{d}
\end{bmatrix}
\mathbf{b}=:
\begin{bmatrix}
\bIloc{d}\\
\bGloc{d}
\end{bmatrix}.
\end{align}
The original system can then be re-ordered as follows,
\begin{align}\label{eq:020}
\begin{bmatrix}
\AIIlocnum{1}&      &            &\AIGlocnum{1}\\
             &\ddots&            &\vdots       \\
             &      &\AIIloc{n_d}&\AIGloc{n_d} \\
\AGIlocnum{1}&\cdots&\AGIloc{n_d}&\AGG
\end{bmatrix}
\begin{bmatrix}
\uIlocnum{1}\\
\vdots      \\
\uIloc{n_d} \\
\uG
\end{bmatrix}
=
\begin{bmatrix}
\bIlocnum{1}\\
\vdots      \\
\bIloc{n_d} \\
\bG
\end{bmatrix},
\end{align}
where 
\begin{align}\label{eq:025}
\AIIloc{d}\uIloc{d}=\bIloc{d}-\AIGloc{d}\uG
\;,\;\;
d=1,\dots,n_d.
\end{align}
Making use of Eq.~\eqref{eq:025} to eliminate $\uIlocnum{1},\dots,\uIloc{n_d}$ from Eq.~\eqref{eq:020} yields a condensed linear system of the form
\begin{align}\label{eq:030}
\mathbf{S}\uG=\bS
\;,\;\;
\bS=\bG-\sum_{1}^{n_d}\AGIloc{d}\AIIloc{d}^{-1}\bIloc{d},
\end{align}
in which $\AIIloc{d}$ is SPD and $\mathbf{S}$, i.e., the global Schur complement operator, admits a decomposition of the form
\begin{align}
\mathbf{S}=\sum_{d=1}^{n_d}\Rloc{d}\mathbf{S}^{(d)}\Rloc{d}^T
\end{align}
with local Schur complements given by
\begin{align}
\mathbf{S}^{(d)}=
\AGGloc{d}-
\AGIloc{d}\AIIloc{d}^{-1}\AIGloc{d}
\;,\;\;
d=1,\dots,n_d.
\end{align}
Note that there exist one-, two- and, more generally, multi-level preconditioners for Eqs.~\eqref{eq:000} and \eqref{eq:030}, which are designed to leverage the locality inherent to domain decomposition in distributed implementations.
An extensive review of multi-level preconditioners based on domain decomposition and their relation to deflation can be found in Tang et al.~\cite{Tang2009}.
Here, we simply present a handful of well known one- and two-level variants.

\subsubsection{Neumann-Neumann (NN)}
Perhaps the most widely known one-level preconditioner for Eq.~\eqref{eq:030} was proposed by De~Roeck and Le~Tallec~\cite{DeRoeck1991}.
This method is referred to as Neumann-Neumann (NN) preconditioning due to the nature of the boundary conditions on the interface of the subdomains when considering the local problems solved through the application of the preconditioner.
To define an NN preconditioner, it is necessary to specify weight matrices $\mathbf{D}_1,\dots,\mathbf{D}_{n_d}$ so as to form a partition of unity, i.e.,
\begin{align}
\sum_{d=1}^{n_d}
\RGloc{d}
\mathbf{D}_d
\RGloc{d}^T
=\mathbf{I}.
\end{align}
A simple choice consists of letting $\mathbf{D}_d$ be diagonal with each non-zero component set to one divided by the number of subdomains to which the DoF is associated.
See \cite{} for other choices of weight matrices.

\begin{algorithm}[ht]
	\caption{Neumann-Neumann preconditioner}
	\label{alg:NN}
	\begin{algorithmic}[1]
		\REQUIRE{$\mathbf{r}\in V_\Gamma$}
		\ENSURE{$\mathbf{z}=\invMNN\mathbf{r}$}
		\FOR[for each subdomain]{$d=1,\dots,n_d$}
		\STATE{$\mathbf{r}^{(d)}:=\mathbf{D}_d^T\RGloc{d}^T\mathbf{r}$}\COMMENT{get local residual}
		\STATE{Find any $\mathbf{z}^{(d)}$ s.t. $\mathbf{S}^{(d)}\mathbf{z}^{(d)}=\mathbf{r}^{(d)}$}\COMMENT{solve local problem}
		\ENDFOR
        \STATE{$\mathbf{z}:=\sum_{d=1}^{n_d}\RGloc{d}\mathbf{D}_d\mathbf{r}^{(d)}$}\COMMENT{average contributions of all subdomains}
	\end{algorithmic}
\end{algorithm}

The local Schur complements $\mathbf{S}^{(1)},\dots,\mathbf{S}^{(n_d)}$ are typically singular.
Thus ***.
Using pseudo-inverses ${\mathbf{S}^{(1)}}^\dagger,\dots,{\mathbf{S}^{(n_d)}}^\dagger$, the following matrix representation is obtained:
\begin{align}
\invMNN=\sum_{d=1}^{n_d}
\RGloc{d}
\mathbf{D}_d
{\mathbf{S}^{(d)}}^\dagger
\mathbf{D}_d
\RGloc{d}^T.
\end{align}
For large numbers of subdomains, ***.
The NN preconditioner does not scale.

\subsubsection{Balanced domain decomposition (BDD)}
Balancing is introduced by Mandel~\cite{Mandel1993} in order to introduce a coarse space such that ****.
Consider the coarse space $V_0\subset V_\Gamma$ and $\Rlocnum{0}$.

\begin{align}
\Rlocnum{0}:=
\begin{bmatrix}
\RGlocnum{1}^T\mathbf{D}_1\mathbf{Z}_1&\dots&\RGloc{n_d}^T\mathbf{D}_{n_d}\mathbf{Z}_{n_d}
\end{bmatrix}
\end{align}


\begin{algorithm}[ht]
	\caption{Balancing domain decomposition preconditioner}
	\label{alg:BDD}
	\begin{algorithmic}[1]
		\REQUIRE{$\mathbf{r}\in V_\Gamma$}
		\ENSURE{$\mathbf{z}=\invMBDD\mathbf{r}$}
		\FOR[for each subdomain:]{$d=1,\dots,n_d$}
		\STATE{Find $\lambda_d$ s.t. $\mathbf{Z}^{(d)}{\mathbf{D}^{(d)}}^T\RGloc{d}^T\left(\mathbf{r}-\mathbf{D}_d^T\RGloc{d}^T\mathbf{r}\right)=0$}\COMMENT{solve local auxiliary problem.}
		\ENDFOR
		\STATE{$\mathbf{s}:=\mathbf{r}-\sum_{d=1}^{n_d}\RGloc{d}\mathbf{D}_d\mathbf{r}^{(d)}$}\COMMENT{balance residual}
		\STATE{$\mathbf{z}:=\sum_{d=1}^{n_d}\RGloc{d}\mathbf{D}_d(\mathbf{u}^{(d)}+\mathbf{Z}\boldsymbol{\mu})$}\COMMENT{average contributions of all subdomains}
	\end{algorithmic}
\end{algorithm}
Using the sqme pseudo-inverses ${\mathbf{S}^{(1)}}^\dagger,\dots,{\mathbf{S}^{(n_d)}}^\dagger$, the following matrix form is obtained,
\begin{align}
\invMBDD=
(\mathbf{I}-\mathbf{S}\mathbf{Q}^{(0)})^T
\invMNN
(\mathbf{I}-\mathbf{S}\mathbf{Q}^{(0)})
+
{\mathbf{Q}^{(0)}},
\end{align}
where
\begin{align}
\mathbf{Q}^{(0)}:=&\RGlocnum{0}\left(\RGlocnum{0}^T\mathbf{S}\RGlocnum{0}\right)^{-1}\RGlocnum{0}^T.%\\
%\mathbf{Q}^{(d)}:=&\RGloc{d}\mathbf{D}_d{\mathbf{S}^{(d)}}^\dagger\mathbf{D}_d\RGloc{d}^T
\end{align}
For elliptic PDEs, ****.


\subsubsection{Low rank Schur (LORASC)}

\begin{align}
\mathbf{S}\mathbf{u}=\lambda\AGG\mathbf{u}
\end{align}

\begin{align}
\tilde{\mathbf{S}}^{-1}=\invAGG+\mathbf{E}\boldsymbol{\Sigma}\mathbf{E}^T
\end{align}
where $\mathbf{E}=[\mathbf{v}_1,\dots,\mathbf{v}_i]$

\subsection{Algebraic multigrid (AMG)}

\section{Deflation results}

\subsection{Weak scaling}
Results in Tab.~\ref{Tab:005} are *.


% 320,000_bj64@hector stuck at 1st attempt of chain 11/50, 
%                           just after realization 3/5 (2,216 iter).
% 320,000_bj128@lucien stuck at 4th attempt of chain 30/50,
%                            just after realization 1/5 (3900 iter).
% 320,000_lorasc128@lucien stuck at 1st attempt of chain 2/50, 
%                                just after realization 4/5 (229 iter).



\begin{table}[ht]
	\caption{Weak scaling results of deflation for a constant bJ preconditioner with $nvec=\lfloor1.25\times nb\rfloor$ and $spdim=3\times nb$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		n & nb & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
		\hline
		20,208  &   8 &   828.6 $\pm$ 166.5 &  10 &  24 &   488.6 $\pm$  93.4 & xxx.xx $\pm$ xx.xx \\
		40,406  &  16 & 1,435.2 $\pm$ 357.2 &  20 &  48 &   715.3 $\pm$ 154.6 & xxx.xx $\pm$ xx.xx \\
		80,598  &  32 & 2,241.5 $\pm$ 528.4 &  40 &  96 & 1,043.2 $\pm$ 294.2 & xxx.xx $\pm$ xx.xx \\
		160,941 &  64 & 3,321.4 $\pm$ 559.3 &  80 & 192 & 1,340.8 $\pm$ 370.6 & xxx.xx $\pm$ xx.xx \\
		321,386 & 128 & 5,698.0 $\pm$ 862.7 & 160 & 384 & 2,996.1 $\pm$ 728.3 & xxx.xx $\pm$ xx.xx \\
		\hline
	\end{tabular}
	\label{Tab:005}
\end{table}


\begin{table}[ht]
\caption{Weak scaling results of deflation for a constant LORASC preconditioner with $\varepsilon=0$, $nvec=\lfloor1.25\times ndom\rfloor$ and $spdim=3\times ndom$.}
\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
	\hline
	n & ndom & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
	\hline
	20,208  &   8 & 243.9 $\pm$  49.9 &  10 &  24 & 158.6 $\pm$ 35.7 & xxx.x $\pm$ xx.x \\
	40,406  &  16 & 348.3 $\pm$  89.6 &  20 &  48 & 181.7 $\pm$ 43.0 & xxx.x $\pm$ xx.x \\
	80,598  &  32 & 453.9 $\pm$ 115.9 &  40 &  96 & 201.6 $\pm$ 51.1 & xxx.x $\pm$ xx.x \\
	160,941 &  64 & 603.2 $\pm$ 134.7 &  80 & 192 & 239.5 $\pm$ 47.0 & xxx.x $\pm$ xx.x \\
	321,386 & 128 & 781.0 $\pm$ 000.0 & 160 & 384 & 280.0 $\pm$ 00.0 & xxx.x $\pm$ xx.x \\
	\hline
\end{tabular}
\label{Tab:010}
\end{table}

\begin{table}[ht]
	\caption{Weak scaling results of deflation for a constant LORASC preconditioner with $\varepsilon=0.01$, $nvec=\lfloor1.25\times ndom\rfloor$ and $spdim=3\times ndom$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
	\hline
	n & ndom & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
	\hline
	20,208  &   8 & 231.6 $\pm$  47.8 &  10 &  24 & 160.0 $\pm$ 36.3 & xxx.x $\pm$ xx.x \\
	40,406  &  16 & 324.5 $\pm$  84.0 &  20 &  48 & 182.3 $\pm$ 44.2 & xxx.x $\pm$ xx.x \\
	80,598  &  32 & 388.7 $\pm$  98.3 &  40 &  96 & 202.5 $\pm$ 53.7 & xxx.x $\pm$ xx.x \\
	160,941 &  64 & 498.3 $\pm$ 116.6 &  80 & 192 & 236.6 $\pm$ 45.4 & xxx.x $\pm$ xx.x \\
	321,386 & 128 & 661.0 $\pm$ 000.0 & 160 & 384 & 283.0 $\pm$ 00.0 & xxx.x $\pm$ xx.x \\
	\hline
\end{tabular}
	\label{Tab:015}
\end{table}



\begin{table}[ht]
	\caption{Weak scaling results of deflation for a constant Neumann-Neumann preconditioner with $nvec=\lfloor1.25\times ndom\rfloor$ and $spdim=3\times ndom$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|c|}
	\hline
	$n$ & $n_\Gamma$ & ndom & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
	\hline
	20,208  & 641    &   8 &  77.6 $\pm$  19.9 &  10 &  24  & 71.3 $\pm$ 17.8 & xxx.x $\pm$ xx.x \\
	40,406  & 1,422  &  16 & 107.3 $\pm$  28.3 &  20 &  48  & 89.7 $\pm$ 27.3 & xxx.x $\pm$ xx.x \\
	80,598  & 2,800  &  32 & 157.2 $\pm$  29.8 &  40 &  96 &  94.9 $\pm$ 27.2 & xxx.x $\pm$ xx.x \\
	160,941 & 5,600  &  64 & 533.9 $\pm$  88.0 &  80 & 192 & 273.1 $\pm$ 84.8 & xxx.x $\pm$ xx.x \\
	321,386 & 11,200 & 128 & 794.0 $\pm$ 129.3 & 160 & 384 & 313.5 $\pm$ 83.0 & xxx.x $\pm$ xx.x \\
	\hline
    \end{tabular}
	\label{Tab:025}
\end{table}

\subsection{Strong scaling results}


\begin{table}[ht]
	\caption{Strong scaling results of deflation for a constant bJ preconditioner with $nvec=\lfloor1.25\times nb\rfloor$ and $spdim=3\times nb$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		n & nb & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
		\hline
		321,386 &   8 & x,xxx.x $\pm$ xx.xx &  10 &  24 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
        321,386 &  16 & x,xxx.x $\pm$ xx.xx &  20 &  48 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
        321,386 &  32 & x,xxx.x $\pm$ xx.xx &  40 &  96 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
        321,386 &  64 & 4,256.9 $\pm$ 452.4 &  80 & 192 & 1,959.0 $\pm$ 550.7 & xxx.xx $\pm$ xx.xx \\
		321,386 & 128 & 5,698.0 $\pm$ 862.7 & 160 & 384 & 2,996.1 $\pm$ 728.3 & xxx.xx $\pm$ xx.xx \\
		\hline
	\end{tabular}
	\label{Tab:030}
\end{table}


\begin{table}[ht]
	\caption{Strong scaling results of deflation for a constant LORASC preconditioner with $\varepsilon=0$, $nvec=\lfloor1.25\times nb\rfloor$ and $spdim=3\times nb$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		n & nb & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
		\hline
		321,386 &   8 & xxx.xx $\pm$ xx.xx &  10 &  24 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
		321,386 &  16 & xxx.xx $\pm$ xx.xx &  20 &  48 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
		321,386 &  32 & xxx.xx $\pm$ xx.xx &  40 &  96 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
		321,386 &  64 & xxx.xx $\pm$ xx.xx &  80 & 192 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
		321,386 & 128 & xxx.xx $\pm$ xx.xx & 160 & 384 & xxx.xx $\pm$ xx.xx & xxx.xx $\pm$ xx.xx \\
		\hline
	\end{tabular}
	\label{Tab:035}
\end{table}


\begin{table}[ht]
	\caption{Strong scaling results of deflation for a constant Neumann-Neumann preconditioner with $nvec=\lfloor1.25\times ndom\rfloor$ and $spdim=3\times ndom$.}
	\centering
	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		$n_\Gamma$ & ndom & \makecell{pcg\\ iter} & nvec & spdim & \makecell{eigdefpcg\\ iter} & \makecell{defpcg\\ iter}\\
		\hline
		xx  &   8 & xxx.x $\pm$  xx.x &  10 &  24 & xxx.x $\pm$ xx.x & xxx.x $\pm$ xx.x \\
		xx  &  16 & xxx.x $\pm$  xx.x &  20 &  48 & xxx.x $\pm$ xx.x & xxx.x $\pm$ xx.x \\
		xx  &  32 & xxx.x $\pm$  xx.x &  40 &  96 & xxx.x $\pm$ xx.x & xxx.x $\pm$ xx.x \\
		xx  &  64 & xxx.x $\pm$  xx.x &  80 & 192 & xxx.x $\pm$ xx.x & xxx.x $\pm$ xx.x \\
		xx  & 128 & xxx.x $\pm$  xx.x & 160 & 384 & xxx.x $\pm$ xx.x & xxx.x $\pm$ xx.x \\
		\hline
	\end{tabular}
	\label{Tab:040}
\end{table}

\subsection{Scaling of AMG}

\begin{table}[ht]
	\caption{Scaling results of the constant AMG preconditioner.}
	\centering
	\begin{tabular}{|c|c|}
		\hline
		n & pcg iter \\
		\hline
		20,208  & 125.9 $\pm$ 35.0 \\
		40,406  & 136.5 $\pm$ 39.2  \\
		80,598  & 144.7 $\pm$ 51.7  \\
		160,941 & 150.4 $\pm$ 48.3  \\
		321,386 & xxx.x $\pm$ xx.x  \\
		\hline
	\end{tabular}
	\label{Tab:020}
\end{table}


\bibliographystyle{siamplain}
\bibliography{references}
\end{document}